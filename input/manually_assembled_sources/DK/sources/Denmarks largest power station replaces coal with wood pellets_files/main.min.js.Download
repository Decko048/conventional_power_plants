//Accutics Cookie Saver tag, Copyright 2019 Accutics. All Rights Reserved.
(function(e){"use strict";if(!Object.entries){Object.entries=function(e){var n=Object.keys(e),r=n.length,t=new Array(r);while(r--)t[r]=[n[r],e[n[r]]];return t}}if(!String.prototype.endsWith){String.prototype.endsWith=function(e,n){if(n===undefined||n>this.length){n=this.length}return this.substring(n-e.length,n)===e}}function n(){if(!e.acq){me({type:"PIXEL_NOT_LOADED"});return}var n=e.acq?e.acq:{};n.libraryLoaded=true;n.version="3.5";n.preload={};n.preload.script=e.acqps?e.acqps:false;n.preload.tag=e.acqpt?e.acqpt:false;n.preload.library=false;var r="3";var t=false;var i=false;var a=false;var o=null;var u=Y();var s=document.location.hostname;var l=F();var f=30;var c=0;const v=3;const d="_acsr_";const p="_acs_";const h="_accutics";var m=null;var g=null;var y=[];var O=[];var k=null;var N=Array.isArray(n.queue)?n.queue:[];var S="."+u;var E=true;var I=true;var b=false;var x="safari";var T="safari";var w=true;var C={endpointRaw:null,endpoint:null,domain:null,httpsOnly:true,cookies:[],browsers:null};function M(){function e(e,n,r,t,i){var a=e+"="+n+";";if(r!==null){a+="expires="+r+";"}if(t!==null){a+="domain="+t+";"}if(i){a+="secure;"}a+="path=/;";document.cookie=a}var r=Date.now();var t=Q();var i="_acs__acsr_";var a=[];Object.entries(t).forEach(function(e){const[n,i]=e;if(n.indexOf(p)===0){var o=true;l.forEach(function(e){if(n===p+e){o=false;return}});if(o){a.push(n);return}try{var u=JSON.parse(t[n]);if(u.c){var s=n.substring(p.length);for(const[e,n]of Object.entries(u.c)){var f=parseInt(n.e,36)*1e3;if(!(e in t)&&f>r){te(e,n.v,new Date(f).toUTCString(),n.r?null:"."+s,n.s?true:false)}}}}catch(e){}}});a.forEach(function(n){var r=t[n];if(n.indexOf(i)===0){if(!(n.substring(i.length)in t)){e(n.substring(i.length),r,null,null,null);return}}if(n.indexOf(p)===0){if(!(n.substring(p.length)in t)){e(n.substring(p.length),r,null,u,null)}}});n.preload.library=true}var A={init:function(){if(t){throw{type:"INIT_ALREADY_DONE"};return}var e=arguments[1];if(!e){me({type:"MISSING_ARGUMENTS",varName:"configuration",varType:"object"});return false}var r=e["endpoint"]?e["endpoint"]:null;if(r===null){me({type:"MISSING_ARGUMENTS",varName:"endpoint",varType:"string"});return false}if(!r||typeof r!="string"){me({type:"INVALID_ARGUMENT",varName:"endpoint",varType:"string"});return false}if(r.indexOf("https")===0||r.indexOf("http")===0||r.indexOf("//")===0){me({type:"ENDPOINT_ERROR"});return false}C.endpointRaw=r;C.endpoint="https://"+r;if(typeof e["domain"]!=="undefined"){if(e["domain"].indexOf("https")===0||e["domain"].indexOf("http")===0||e["domain"].indexOf("//")===0){me({type:"DOMAIN_ERROR"});return false}C.domain=e["domain"].indexOf(".")===0?e["domain"]:"."+e["domain"]}else{C.domain=S}if(typeof e["safariOnly"]!=="undefined"){C.browsers=!Boolean(e["safariOnly"])?"all":T}else{C.browsers=T}C.httpsOnly=typeof e["httpsOnly"]!=="undefined"?Boolean(e["httpsOnly"]):w;o=_.init().browser;y=Q();try{m=JSON.parse(y[h]);if(m["v"]!==n.version){throw"wrong version"}c=parseInt(m["r"])}catch(e){ve();z([])}t=true;if(D()){M()}return true},addCookie:function(){R();var e=arguments[1];var n=e["name"]?e["name"]:null;var r=e["expirationDays"]?e["expirationDays"]:null;if(n===null){me({type:"MISSING_ARGUMENTS",varName:"name",varType:"string"});return false}if(r===null){me({type:"MISSING_ARGUMENTS",varName:"expirationDays",varType:"number"});return false}if(!(typeof r==="number"&&r%1===0)){me({type:"INVALID_ARGUMENT",varName:"expirationDays",varType:"number"});return false}var t=typeof e["autoExtend"]!=="undefined"?Boolean(e["autoExtend"]):E;var o=typeof e["domain"]!=="undefined"?e["domain"]:C.domain;var u=typeof e["backup"]!=="undefined"?Boolean(e["backup"]):I;var s=typeof e["secure"]!=="undefined"?Boolean(e["secure"]):b;var l=null;if(typeof e["safariOnly"]!=="undefined"){l=!Boolean(e["safariOnly"])?"all":x}else{l=C.browsers}if(C.cookies.filter(function(e){if(e.name===n){return e}}).length>0){return true}C.cookies.push({name:n,expiration:r,autoExtend:t,domain:o,backup:u,browsers:l,secure:s});if(!i&&a){}return true},deleteCookie:function(){R();var e=arguments[1];var n=[];if(!e||!e["names"]||e["names"].length===0){me({type:"MISSING_ARGUMENTS",varName:"names",varType:"array"});return false}else if(e&&e["names"]&&Array.isArray(e["names"])){n=e["names"]}var r=C.cookies.filter(function(e){if(n.indexOf(e.name)!==-1){return e}});ue(r);return true},removeCookieSaver:function(){return oe()},start:function(){R();return U()},stop:function(){return B()},update:function(){R();var e=arguments[1];var n=[];var r=false;if(!e||!e["names"]||e["names"].length===0){r=true}else if(e&&e["names"]&&Array.isArray(e["names"])){n=e["names"]}var t=C.cookies.filter(function(e){if(r||n.indexOf(e.name)!==-1){return e}});return le(P(t))},validate:function(){return ae()},printConfig:function(){console.log("Cookie Saver version: "+n.version);console.log(C)}};n.callMethod=function(){if(arguments.length<1){me({type:"MISSING_ARGUMENTS",varName:"attributes",varType:"object"});return false}var e=arguments[0];if(typeof e!=="string"){me({type:"INVALID_METHOD_NAME",given:e});return false}if(!A[e]||typeof A[e]!=="function"){me({type:"INVALID_METHOD_NAME",given:e});return false}if(arguments[1]){return A[e].apply(n,arguments)}return A[e].apply(n,{});return false};var _={header:[navigator.platform,navigator.userAgent,navigator.appVersion,navigator.vendor,e.opera],dataos:[{name:"Windows Phone",value:"Windows Phone",version:"OS"},{name:"Windows",value:"Win",version:"NT"},{name:"iPhone",value:"iPhone",version:"OS"},{name:"iPad",value:"iPad",version:"OS"},{name:"Kindle",value:"Silk",version:"Silk"},{name:"Android",value:"Android",version:"Android"},{name:"PlayBook",value:"PlayBook",version:"OS"},{name:"BlackBerry",value:"BlackBerry",version:"/"},{name:"Macintosh",value:"Mac",version:"OS X"},{name:"Linux",value:"Linux",version:"rv"},{name:"Palm",value:"Palm",version:"PalmOS"}],databrowser:[{name:"Chrome",value:"Chrome",version:"Chrome"},{name:"Firefox",value:"Firefox",version:"Firefox"},{name:"Safari",value:"Safari",version:"Version"},{name:"Internet Explorer",value:"MSIE",version:"MSIE"},{name:"Opera",value:"Opera",version:"Opera"},{name:"BlackBerry",value:"CLDC",version:"CLDC"},{name:"Mozilla",value:"Mozilla",version:"Mozilla"}],init:function(){var e=this.header.join(" "),n=this.matchItem(e,this.dataos),r=this.matchItem(e,this.databrowser);return{os:n,browser:r}},matchItem:function(e,n){var r=0,t=0,i="",a,o,u,s,l;for(r=0;r<n.length;r+=1){a=new RegExp(n[r].value,"i");u=a.test(e);if(u){o=new RegExp(n[r].version+"[- /:;]([\\d._]+)","i");s=e.match(o);l="";if(s){if(s[1]){s=s[1]}}if(s){s=s.split(/[._]+/);for(t=0;t<s.length;t+=1){if(t===0){l+=s[t]+"."}else{l+=s[t]}}}else{l="0"}return{name:n[r].name,version:parseFloat(l)}}}return{name:"unknown",version:0}}};function R(){if(!t){throw{type:"MISSING_INIT"}}}function D(){if(n.preload.script&&n.preload.script.version===3){return false}if(c>0){return false}if(n.preload.tag||n.preload.library){return false}return true}function L(){if(i){return true}return P().length>0}function G(e){return e&&e.name==="Safari"&&e.version>=12.1}function U(){a=true;if(i){return true}if(!L()){return true}i=true;se();e.setTimeout(function(){},1500);pe();return true}function B(){a=false;if(!i){return true}if(g){clearTimeout(g)}i=false;return true}function P(e=null){if(e===null){e=C.cookies}var n=[];if(e.length===0){return n}var r=G(o);e.forEach(function(e){if(r||e.browsers==="all"){n.push(e)}});return n}function J(e){var n={};n.n=e.name;n.d=e.domain;n.l=e.expiration;if(e.secure){n.s=1}return n}function q(){return C.endpoint+"/"+r+"/slice"+"?rd="+u+"&n="+Math.floor(Date.now()/1e3)}function V(e){var n=Math.floor(Date.now()/1e3);var t=e.map(function(e){return J(e)});return C.endpoint+"/"+r+"/cut"+"?rd="+C.domain+"&n="+n.toString(36)+"&s="+(C.httpsOnly?"1":"0")+(t.length>0?"&dl="+encodeURIComponent(JSON.stringify(t)):"")}function j(e){var n=e.freshOriginalCookies?e.freshOriginalCookies.map(function(e){return J(e)}):[];var t=e.freshBackupCookies?e.freshBackupCookies.map(function(e){return J(e)}):[];var i=e.freshOriginalCookies?e.freshLoadCookies.map(function(e){return J(e)}):[];var a=e.staleLoadCookies?e.staleLoadCookies.map(function(e){return J(e)}):[];var o=e.saveCookies?e.saveCookies.map(function(e){return J(e)}):[];var u=e.acsrSaveCookies?e.acsrSaveCookies.map(function(e){return J(e)}):[];return C.endpoint+"/"+r+"/cut"+"?rd="+C.domain+"&n="+e.currentTime.toString(36)+"&s="+(C.httpsOnly?"1":"0")+(n.length>0?"&fo="+encodeURIComponent(JSON.stringify(n)):"")+(t.length>0?"&fb="+encodeURIComponent(JSON.stringify(t)):"")+(i.length>0?"&fl="+encodeURIComponent(JSON.stringify(i)):"")+(a.length>0?"&sl="+encodeURIComponent(JSON.stringify(a)):"")+(o.length>0?"&sv="+encodeURIComponent(JSON.stringify(o)):"")+(u.length>0?"&as="+encodeURIComponent(JSON.stringify(u)):"")}function W(e){var n=document.createElement("img");n.height=1;n.width=1;n.style.display="none";n.src=e}function z(e){ee(h,JSON.stringify({v:n.version,r:c,el:e}),0,false)}function F(){if(u===null){return[]}var e=[u];var n=s.substring(0,s.length-u.length);if(n.length>0){var r=n.split(".");r.pop();var t=u;for(var i=r.length-1;i>=0;i--){t=r[i]+"."+t;e.push(t)}}return e}function H(e){var n=[];l.forEach(function(e){if(p+e in y){var r={};try{r=JSON.parse(y[p+e])}catch(e){}n[e]=r}});return n}function X(e,n){if(e.indexOf(".")===0){e=e.substring(1)}if(e in O&&O[e].c){if(n in O[e].c){return O[e].c[n]}}return null}function Y(){var e="cs_test_cookie=1";var n=document.location.hostname.split(".");for(var r=n.length-1;r>=0;r--){var t=n.slice(r).join(".");document.cookie=e+";domain=."+t+";";if(document.cookie.indexOf(e)>-1){document.cookie=e.split("=")[0]+"=;domain=."+t+";expires=Thu, 01 Jan 1970 00:00:01 GMT;";return t}}return null}function K(){return document.location.hostname}function Q(){var e=document.cookie;if(e===""){return[]}e=e.split(/; */);var n={};for(var r=0;r<e.length;r++){n[e[r].substring(0,e[r].indexOf("="))]=e[r].substring(e[r].indexOf("=")+1)}return n}function Z(e,n){var r=[];e.forEach(function(e){if(n[e.name]){r.push(e.name+"="+n[e.name])}});l.forEach(function(e){if(n[p+e]){r.push(p+e+"="+n[p+e])}});return r.join(";")}function $(e,n,r,t,i=null){te(e,n,r,t,i,C.domain)}function ee(e,n,r,t,i=null){te(e,n,r,t,i,null)}function ne(e,n,r,t,i=null){te(e,n,r,t,i,"."+s)}function re(e,n,r,t,i=null){te(e,n,r,t,i,"."+u)}function te(e,n,r,t,i,a){var o="";o+=e+"="+n+";";if(r>0){var u=new Date;u.setTime(u.getTime()+r*24*60*60*1e3);o+="expires="+u.toUTCString()+";"}else if(i!==null){o+="max-age="+i+";"}if(a!=null){o+="domain="+a+";"}o+="path=/;";if(t){o+="secure;"}document.cookie=o}function ie(){var e=y[p+u];if(e&&e.m){var n=new Date;var r=((new Date).getFullYear()+"").substring(2)+(n.getMonth()+1>9?""+n.getMonth()+1:"0"+n.getMonth()+1);if(e.m<r){var t=q();W(t)}}return true}function ae(){var r=[];C.cookies.forEach(function(e){var n=false;if(e.domain===s){n=true;return}l.forEach(function(r){if(e.domain==="."+r){n=true;return}});if(!n){r.push({name:e.name,domain:e.domain})}});var t=null;if(!C.endpointRaw.endsWith(s)){t="Error: The specified endpoint '"+C.endpointRaw+"' is not valid for the current domain '"+s+"'"}var i=null;if(n.preload.script===false){i="Warning: The preload script is missing or not loaded correctly."}var a=null;if(C.httpsOnly&&e.location.protocol==="http:"){a="The option 'httpsOnly' must be set to false to be compatible with the current website protocol 'http', otherwise Cookie Saver will not work properly."}console.log("********** Cookie Saver - Validation Results **********");console.log("");if(t!==null){console.log(t);console.log("")}if(i!==null){console.log(i);console.log("")}if(a!==null){console.log(a);console.log("")}if(r.length>0){r.forEach(function(e){console.log("The cookie '"+e.name+"' has an invalid domain '"+e.domain+"' for the current domain '"+s+"'")})}else{console.log("-> All configured cookie domains are valid for '"+s+"'")}console.log("");console.log("*****************************************************")}function oe(){B();y=Q();var e=[];for(var n in y){if(n.indexOf(d)===0||n.indexOf(p)===0||n.indexOf(h)===0){ee(n,"",0,false,0);l.forEach(function(e){te(n,"",0,false,0,"."+e)})}}return true}function ue(e){if(e.length===0){return true}e.forEach(function(e){for(var n=0;n<C.cookies.length;n++){if(e.name===C.cookies[n].name){C.cookies.splice(n,1);break}}});var n=V(e);W(n);return true}function se(e=false){fe(P(),"auto",e)}function le(e,n=false){fe(e,"manual",n)}function fe(n,r,t){var i=Date.now();if(!Array.isArray(n)||n.length===0){return false}y=Q();O=H(l);var a=Z(n,y);if(k===a&&r==="auto"){return true}k=a;var o=ce(n,r);if(!o.changes){return true}var u=j(o);o.acsrSaveCookies.forEach(function(e){re(d+e.name,y[e.name],null,e.secure,3)});if(t){e.navigator.sendBeacon(u)}else{W(u)}c+=1;z(o.extendedCookiesInSession);var s=Date.now();return true}function ce(e,n){var r=y;var t=Math.floor(Date.now()/1e3);m={};try{m=r[h]?JSON.parse(r[h]):{}}catch(e){}var i=m.el?m.el:[];var a=[];var o=[];var u=[];var c=[];var v=[];var d=[];e.forEach(function(e){var n=e;var p=typeof r[n.name]!=="undefined";var h=false;var m=X(n.domain,n.name);if(m!==null&&p&&r[n.name]!==m.v){h=true}if(n.domain.indexOf(".")===0){if(l.indexOf(n.domain.substring(1))>-1){if(n.backup){if(n.autoExtend){if(h){v.push(n);return}if(m===null&&p){v.push(n);return}if(m!==null&&!p){u.push(n);return}if(m!==null&&parseInt(m.e,36)-n.expiration*24*60*60+f*60<t){v.push(n);return}}else{if(h){v.push(n);return}if(m===null&&p){v.push(n);return}if(m!==null&&!p){c.push(n);return}}}else{if(n.autoExtend){if(p){if(i.indexOf(n.name)===-1){a.push(n);i.push(n.name);return}}else{}}else{}}}else{}}else{if(n.domain===s){if(n.backup){if(n.autoExtend){if(h){d.push(n);return}if(m===null&&p){d.push(n);return}if(m!==null&&!p){o.push(n);ee(n.name,m.v,m.e,n.secure);return}if(m!==null&&parseInt(m.e,36)-n.expiration*24*60*60+f*60<t){o.push(n);return}}else{if(h){d.push(n);return}if(m!==null&&!p){var g=parseInt(m.e,36);if(g>t){ee(n.name,m.v,m.e,n.secure);return}}if(m===null&&p){d.push(n);return}}}else{}}else{}}});var p=a.length>0||o.length>0||u.length>0||c.length>0||v.length>0||d.length>0;return{freshOriginalCookies:a,freshBackupCookies:o,freshLoadCookies:u,staleLoadCookies:c,saveCookies:v,acsrSaveCookies:d,extendedCookiesInSession:i,changes:p,currentTime:t}}function ve(){y=Q();for(var e in y){if(e.indexOf(d)===0){ee(e,"",0,false,0);l.forEach(function(n){te(e,"",0,false,0,"."+n)})}if(e.indexOf(p)===0){var n=true;var r=null;l.forEach(function(r){if(e===p+r){n=false;return}});if(n){te(e,"",0,false,0,null);l.forEach(function(n){te(e,"",0,false,0,"."+n)})}}}return true}function de(){e.addEventListener("beforeunload",function(e){se(true)})}function pe(){he()}function he(){if(!a){return true}g=e.setTimeout(function(){se();he()},v*1e3)}function me(e){console.warn("[Cookie Saver] "+ge(e))}function ge(e){switch(e.type){case"PIXEL_NOT_LOADED":return"Cookie Saver is not loaded correctly. Make sure the pagecode is correctly implemented and initialized.";case"MISSING_INIT":return"Cookie Saver is not initialized correctly, missing init call.";case"INIT_ALREADY_DONE":return"Cookie Saver has already been initialized. Not possible to initialize again.";case"DOMAIN_ERROR":return"Domain should be without the protocol, e.g. .accutics.com";case"ENDPOINT_ERROR":return"Endpoint should be without the protocol, e.g. cookiesaver.accutics.com";case"MISSING_ARGUMENTS":return"Arguments must be provided <"+e.varName+">("+e.varType+").";case"INVALID_METHOD_NAME":return"Method name "+e.given+" (1st argument) must be a string and a valid method name.";case"INVALID_ARGUMENT":return"Argument '"+e.varName+"' must be of type '"+e.varType+"'";case"METHOD_ERROR":return"An error occured while running a method from the queue. Aborting.";case"LOCAL_ENVIRONMENT":return"The environment seems to be local. Aborting.";default:return"Unknown exception: "+e.type+" - "+JSON.stringify(e)}}if(u===null){me({type:"LOCAL_ENVIRONMENT"});return n}while(N.length>0){var ye=N.shift();var Oe=n.callMethod.apply(n,ye);if(!Oe){me({type:"METHOD_ERROR"});break}}return n}e.acq=n()})(window);