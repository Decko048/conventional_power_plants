var geoXmlHttpReq = null;
var geoContainer = null;
var geoXmlHttpReqErr = "Error initializing. Please try again. ";
var geoXmlHttpReqLoading = "<span class='attention'>Loading...</span>";
var geoXmlHttpReqProcessing = "<span class='attention'>Processing...</span>";
var db_id;
var callee;

google.load("language", "1");
function translate( to ) {
        var text_container = document.getElementById("wrapperIndex");
        var text = text_container.innerHTML;
        google.language.detect(text, function(result) {
                        if (!result.error && result.language) {
                        google.language.translate(text, result.language, "en",
                                function(result) {
                                if (result.translation) {
                                text_container.innerHTML = '';
                                text_container.innerHTML = result.translation;
                                }
                                });
                        }
                        });

        /*
        google.language.translate(text, "en", to, 
                        function(result) {
                            alert( result);
                            if( result.translation ) {
                                alert( result.translation);
                                text_container.innerHTML = result.translation;
                            }
                        });
                        */
}

function obtainGeoXmlHttpRequest () {
	if ( window.XMLHttpRequest && !(window.ActiveXObject) ) { // for firefox & safari
		try {
			geoXmlHttpReq = new XMLHttpRequest();
		} catch(e) {
			geoXmlHttpReq = false;
		}
	} else if ( window.ActiveXObject ) { // for IE
		try {
			geoXmlHttpReq = new ActiveXObject("Msxml2.XMLHTTP");
		} catch(e) {
			try {
				geoXmlHttpReq = new ActiveXObject("Microsoft.XMLHTTP");
			} catch(e) {
				geoXmlHttpReq = false;
			}
		}
	}
}


function commonHandler () {
	if ( 3 == geoXmlHttpReq.readyState ) {
		document.getElementById(geoContainer).innerHTML = geoXmlHttpReqLoading;
	} else if ( 4 == geoXmlHttpReq.readyState ) {
		if ( 200 == geoXmlHttpReq.status ) {
//			alert(geoXmlHttpReq.responseText);
			document.getElementById(geoContainer).innerHTML = geoXmlHttpReq.responseText;
		} else {
			alert(geoXmlHttpReqErr);
		}
	}
}

function toggleMapFeature( toggle ) {
	//	alert(document.form.Toggle.length);
	var baseuri = document.getElementById("CurrentPage_sys").value;
	for ( i=0; i<document.forms['build_network'].Toggle.length; i++ ) {
		if ( document.forms['build_network'].Toggle[i].checked == true ) {
			window.open(baseuri + '?tgl='+document.forms['build_network'].Toggle[i].value, target='_self');
		}
	}
}
function toggleNewEdit (toggle) {
	//	alert(document.form.Toggle.length);
	var baseuri = document.getElementById("CurrentPage_sys").value;
	for ( i=0; i<document.forms['select'].Toggle.length; i++ ) {
		if ( document.forms['select'].Toggle[i].checked == true ) {
			window.open(baseuri + '?tgl='+document.forms['select'].Toggle[i].value, target='_self');
		}
	}
}

function openNewEntry() {
    var Desc_ID = document.getElementById("New").value;
    url = "form.php?pid=" + Desc_ID;
    window.open(url);
}

function showDiff () {
	geoXmlHttpReq = null;
	obtainGeoXmlHttpRequest();
	if ( null == geoXmlHttpReq ) {
		alert(geoXmlHttpReqErr);
		return;
	}
		
	geoContainer = "diff_container";
    document.getElementById(geoContainer).innerHTML = geoXmlHttpReqLoading;

	var Desc_ID = document.getElementById("Edit").value;

	var url = "/geoutility.php?op=Diff&did=" + Desc_ID;
	
	geoXmlHttpReq.onreadystatechange = commonHandler;
	geoXmlHttpReq.open("GET", url, true);
	geoXmlHttpReq.send(null);
}

function getState ( CountryTagId ) {
	geoXmlHttpReq = null;
	obtainGeoXmlHttpRequest();
	if ( null == geoXmlHttpReq ) {
		alert(geoXmlHttpReqErr);
		return;
	}
		
	geoContainer = "states_container";
	var StateName = document.getElementById("StateName_sys").value;

	var url = "/geoutility.php?op=States&cid=" + document.getElementById(CountryTagId).value + "&fn=" + StateName;
	
	geoXmlHttpReq.onreadystatechange = commonHandler;
	geoXmlHttpReq.open("GET", url, true);
	geoXmlHttpReq.send(null);
}

function getSecurityImage () {
	geoXmlHttpReq = null;
	obtainGeoXmlHttpRequest();
	if ( null == geoXmlHttpReq ) {
		alert(geoXmlHttpReqErr);
		return;
	}
	var enCode = document.getElementById("EncryptedCode").value;
	var iv = document.getElementById("iv").value;
	var url = '/geoutility.php?op=SecurityImage&enCode='+enCode+'&iv='+iv;
//	document.images['SecurityImage'].src = url; 

	geoContainer = "code_container";

//	var url = "geoutility.php?op=SecurityCode";
	geoXmlHttpReq.onreadystatechange = commonHandler;
	geoXmlHttpReq.open("GET", url, true);
	geoXmlHttpReq.send(null);

}

function acceptChanges( Submission_ID, Parent_Plant_ID, Moderator_ID ) {
    var sure = confirm( "You are about to accept changes from this submission. Are you sure?" );
    if( sure ) {
        com = document.getElementById("AcceptComments").value;
        com = escape(com);
        var url = "/geoutility.php?op=AcceptChanges&ppid="+Parent_Plant_ID+"&sid="+Submission_ID+"&mid="+Moderator_ID+"&com="+com;
        window.location = url;
    }
    else return false;
} 

function rejectChanges( Submission_ID, Parent_Plant_ID, Moderator_ID ) {
    var sure = confirm( "You are about to reject changes from this submission. Are you sure?" );
    if( sure ) {
        com = document.getElementById("AcceptComments").value;
        com = escape(com);
        var url = "/geoutility.php?op=RejectChanges&ppid="+Parent_Plant_ID+"&sid="+Submission_ID+"&mid="+Moderator_ID+"&com="+com;
        window.location = url;
    }
    else return false;
} 

function showDb( callee ) {
    
	geoXmlHttpReq = null;
	obtainGeoXmlHttpRequest();
	
	if ( null == geoXmlHttpReq ) {
		alert(geoXmlHttpReqErr);
		return;
	}

	geoContainer = "db_container";
    params='';
    if( callee ) {
        geoContainer = callee + "_" + geoContainer;
        params += "&callee=" + callee;
    }

    j=0;

	var op = escape ( 'menu_db' );
	var url = "/geoutility.php?op="+ op + params;
	geoXmlHttpReq.onreadystatechange = commonHandler;
	geoXmlHttpReq.open("GET", url, true);
	geoXmlHttpReq.send(null);
}

function ai_add() {
    showDb( "ai" ); 
    document.getElementById('Add_Associated_Infrastructure').style.visibility="hidden";
    document.getElementById('Delete_Associated_Infrastructure').style.visibility="hidden";
}

function showAddAIButton() {
    var button = "<input type='button' name='addAI' id='addAI' value='Add AI' onclick='addAi()' />";
    document.getElementById('ai_add_button_container').innerHTML = button;
}

var tr;
var noofai;

function addAi() {
    /*
    if( document.getElementById( 'AI_Other' ).value == null && document.getElementById( 'ai_Name' ).value == null ) {
       alert( "Either select the name of the plant from the list. If it is not found in the list, enter it's name in the text box." ); 
       return;
    }
    else if( document.getElementById( 'AI_Other' ).value != null && document.getElementById( 'ai_Name' ).value != null ) {
       alert( "Please do not choose a resource from GEO and also enter missing resource information for the same associated infrastructure. If the resource is not found in GEO, please enter it's information as a separate Associated Infrastructure. "); 
       return;
    }
    */
	geoXmlHttpReq = null;
	obtainGeoXmlHttpRequest();
	
	if ( null == geoXmlHttpReq ) {
		alert(geoXmlHttpReqErr);
		return;
	}
	
	geoContainer = "";
	
	noofai = document.getElementById("NumberOfAI").value;
	var op = escape ( 'add_ai' );
    selIndex = document.getElementById("ai_Name").selectedIndex;
    var AI_Name; 
    var LM_ID;
    if( selIndex > -1 ) {
        AI_Name = document.getElementById("ai_Name").options[selIndex].text;
        LM_ID = document.getElementById("ai_Name").options[selIndex].value;
    }
    selIndex = document.getElementById("ai_Type").selectedIndex;
    var AI_Type_ID = document.getElementById("ai_Type").options[selIndex].value;

    selIndex = document.getElementById("ai_Country").selectedIndex;
    var AI_Country_ID = document.getElementById("ai_Country").options[selIndex].value;

    selIndex = document.getElementById("ai_State").selectedIndex;
    var AI_State_ID = document.getElementById("ai_State").options[selIndex].value;

    var AI_Other_Name = document.getElementById("AI_Other").value;

	tr = document.createElement("tr");
	tr.setAttribute("id", "ai"+(parseInt(noofai)+1));
	
	var url = "/geoutility.php?op="+ op + "&ai_name=" + AI_Name + "&lm_id=" + LM_ID + "&ai_ty_id=" + AI_Type_ID + "&ai_cnt_id=" + AI_Country_ID + "&ai_st_id=" + AI_State_ID + "&ai_ot_name=" + AI_Other_Name + "&no=" + noofai;
	
	geoXmlHttpReq.onreadystatechange = addAIHandler;
	geoXmlHttpReq.open("GET", url, true);
	geoXmlHttpReq.send(null);
	
}

function addAIHandler() {

	if ( 3 == geoXmlHttpReq.readyState ) {
		document.getElementById(geoContainer).innerHTML = geoXmlHttpReqLoading;
	} else if ( 4 == geoXmlHttpReq.readyState ) {
		if ( 200 == geoXmlHttpReq.status ) {
			$str = geoXmlHttpReq.responseText;
			$arr = $str.split("<td>");
		    
            var text = '';
            var td = document.createElement("td");
			for ( i=0; i<$arr.length; i++) {
                text += $arr[i].trim(); 
			}
			td.innerHTML = text;
			tr.appendChild(td);

			document.getElementById("ai0").parentNode.appendChild(tr);
			document.getElementById("NumberOfAI").value = ++noofai; 
		
            document.getElementById("ai_db_container").innerHTML = "";    
            document.getElementById("ai_type_container").innerHTML = "";    
            document.getElementById("ai_country_container").innerHTML = "";    
            document.getElementById("ai_state_container").innerHTML = "";    
            document.getElementById("ai_name_container").innerHTML = "";    
            document.getElementById("ai_other_container").innerHTML = "";    
            document.getElementById("ai_add_button_container").innerHTML = "";    
            document.getElementById('Add_Associated_Infrastructure').style.visibility="visible";
            document.getElementById('Delete_Associated_Infrastructure').style.visibility="visible";
		} else {
			alert(geoXmlHttpReqErr);
		}
	}
}

function deleteAI() {
	noofai = document.getElementById("NumberOfAI").value;
	var oldNum = noofai;
	for ( i=1; i<=noofai; i++ ) {
		var aicheck = document.getElementById("aicheck"+i);
		if ( aicheck && aicheck.checked ) {
			document.getElementById("ai0").parentNode.removeChild ( document.getElementById("ai"+i) );
	        document.getElementById("NumberOfAI").value = --noofai;
		}
	}
   // updateSequence( '', 'AI', oldNum );
	
}

function showAIOther() {
    
	geoXmlHttpReq = null;
	obtainGeoXmlHttpRequest();
	
	if ( null == geoXmlHttpReq ) {
		alert(geoXmlHttpReqErr);
		return;
	}

	geoContainer = "ai_other_container";
    params='';
    j=0;

	var op = escape ( 'menu_ai_other' );
	var url = "/geoutility.php?op="+ op + params;
	geoXmlHttpReq.onreadystatechange = commonHandler;
	geoXmlHttpReq.open("GET", url, true);
	geoXmlHttpReq.send(null);
}

function showType( callee ) {
	geoXmlHttpReq = null;
	obtainGeoXmlHttpRequest();
	
	if ( null == geoXmlHttpReq ) {
		alert(geoXmlHttpReqErr);
		return;
	}

    params='';
    db_id = 'db';
	geoContainer = "type_container";
    if( callee ) {
        geoContainer = callee + "_" + geoContainer;
        params += "&callee=" + callee;
        db_id = callee + "_" + db_id;
    }

    j=0;
    for( i=0; i<document.getElementById(db_id).length; i++) { 
        if( document.getElementById(db_id).options[i].selected) {
            params += "&db"+j+"=" + document.getElementById(db_id).options[i].value;
            j++;
        }
    }
    params += "&dbcount="+j;
    if( document.getElementById('multiple_sys') ) {
        if( document.getElementById('multiple_sys').value == 'true' )
            params += "&multiple=true";
    }
	var op = escape ( 'menu_type' );
	var url = "/geoutility.php?op="+ op + params;
	geoXmlHttpReq.onreadystatechange = commonHandler;
	geoXmlHttpReq.open("GET", url, true);
	geoXmlHttpReq.send(null);
}

/***************Priya: Adding following methods for Analyses of data***************/
function clearText(field) 
{
    if( document.getElementById(field) )
		document.getElementById(field).innerHTML = "";
}

function clearContextHelp( element ) 
{
	var data = element.id;
	var container = "";
	
	switch (data) {
	
	case "View_Table":
	case "View_Graph":
	case "View_Map":
		container = "viewformat_help_container";
		break;
	case "Graph_Individual_Data":
	case "Graph_Aggregate_Data":
	case "Graph_Overlay_Data":
		container = "graphtype_help_container";
		break;
	}
	
    if( document.getElementById(data) )
		document.getElementById(container).innerHTML = "";
}

function showContextHelp( element )
{
	var data = element.id;
	
	switch (data) {
	
	case "View_Table":
		text = "<i><font size = 2 color = 'blue'>Displays the analysis result as a table</font></i>";
		document.getElementById("viewformat_help_container").innerHTML = text;
		break;		
	case "View_Graph":
		text = "<i><font size = 2 color = 'blue'>Displays the analysis result as a graph</font></i>";
		document.getElementById("viewformat_help_container").innerHTML = text;
		break;		
	case "View_Map":
		text = "<i><font size = 2 color = 'blue'>Displays the analysis result on a map</font></i>";
		document.getElementById("viewformat_help_container").innerHTML = text;
		break;		
	case "Graph_Individual_Data":
		text = "<i><font size = 2 color = 'blue'>Each Plant type will be Graphed individually</font></i>";
		document.getElementById("graphtype_help_container").innerHTML = text;
		break;		
	case "Graph_Aggregate_Data":
		text = "<i><font size = 2 color = 'blue'>Aggregates selected data for different Plant Types<br>and shows in one graph</font></i>";
		document.getElementById("graphtype_help_container").innerHTML = text;
		break;
	case "Graph_Overlay_Data":
		text = "<i><font size = 2 color = 'blue'>Each Plant type will be Graphed individually<br> And displayed in same graph</font></i>";
		document.getElementById("graphtype_help_container").innerHTML = text;
		break;
	}
}


function showHelp( data ) 
{

	if(data == "newCapacity")
	{
		text = "<i><font size = 1 color = 'blue'>Shows New Capacity Installed versus Years</font></i>";
		document.getElementById("data_continer").innerHTML = text;
	}
	else if(data == "cumCapacity")
	{
		text = "<i><font size = 1 color = 'blue'>Shows Cumulative Capacity for each Plant Type versus Years</font></i>";
		document.getElementById("data_continer").innerHTML = text;
	}
	else if(data == "powerGen")
	{
		text = "<i><font size = 1 color = 'blue'>Shows Annual Power Generated versus Years for the selected Country and Plant Type</font></i>";
		document.getElementById("data_continer").innerHTML = text;
	}
	else if(data == "annPerf")
	{
		text = "<i><font size = 1 color = 'blue'>Printout of all power plants with their annual performance data for Total Gigawatt Hours Generated, Fuel Consumed and CO2 Emitted.</font></i>";
		document.getElementById("data_continer").innerHTML = text;
	}
	else if(data == "genUnits")
	{
		text = "<i><font size = 1 color = 'blue'>Printout of all power plants, their capacity, plant load factor and performance for selected year</font></i>";
		document.getElementById("data_continer").innerHTML = text;
	}
	//else if(data == "individualHelp_container")
	else if(data == "individual_graph")
	{
		text = "<i><font size = 1 color = 'blue'>Each Plant type will be Graphed individually</font></i>";
		document.getElementById("graphtype_help_container").innerHTML = text;
	}
	//else if(data == "aggregateHelp_container")
	else if(data == "aggregate_graph")
	{
		text = "<i><font size = 1 color = 'blue'>Aggregates selected data for different Plant Types<br>and shows in one graph</font></i>";
		document.getElementById("graphtype_help_container").innerHTML = text;
	}
	//else if(data == "overlayHelp_container")
	else if(data == "overlay_graph")
	{
		text = "<i><font size = 1 color = 'blue'>Each Plant type will be Graphed individually<br> And displayed in same graph</font></i>";
		document.getElementById("graphtype_help_container").innerHTML = text;
	}
	//Priya: This is added for module "Build your n/w"
	else if(data == "buildNw_country")
	{
		text = "<i><font size = 1 color = 'blue'>choose a country to map data</font></i>";
		document.getElementById("countryHelp_container").innerHTML = text;
	}
	else if(data == "buildNw_state")
	{
		text = "<i><font size = 1 color = 'blue'>select one or more state to<br>simulate and analyze your construction</font></i>";
		document.getElementById("stateHelp_container").innerHTML = text;
	}
}

function showAnalysisType (element) 
{

	geoXmlHttpReq = null;
	obtainGeoXmlHttpRequest();
	
	if ( null == geoXmlHttpReq ) 
	{
		alert(geoXmlHttpReqErr);
		return;
	}
	
	geoContainer = "type_container";
	document.getElementById(geoContainer).innerHTML = "";
	
	var AnalysisType = document.getElementById("Type_Analysis_RB").value;
	var Category = element.value;
	var op = escape ( 'menu_type_analysis' );
	var isAnalysis = escape ( 'table' );
	var url = "/geoutility.php?op="+ op + "&analysisType=" + AnalysisType + "&Category=" + Category + "&isAnalysis=" + isAnalysis ;

	geoXmlHttpReq.onreadystatechange = AnalysisTypeHandler;
	geoXmlHttpReq.open("GET", url, true);
	geoXmlHttpReq.send(null);
}

function AnalysisTypeHandler() {

	if ( 3 == geoXmlHttpReq.readyState ) {
		document.getElementById("type_container").innerHTML = geoXmlHttpReqLoading;
	} else if ( 4 == geoXmlHttpReq.readyState ) {
		if ( 200 == geoXmlHttpReq.status ) {
			document.getElementById("type_container_label").innerHTML = "Type";
			document.getElementById("type_container").innerHTML = geoXmlHttpReq.responseText;
            showAnalysisConfig();
            showAnalysisButton();
		} else {
			alert(geoXmlHttpReqErr);
		}
	}
}

function showAnalysisCountry () 
{
	geoXmlHttpReq = null;
	obtainGeoXmlHttpRequest();
	
	if ( null == geoXmlHttpReq ) 
	{
		alert(geoXmlHttpReqErr);
		return;
	}

	geoContainer = "country_container";
	document.getElementById(geoContainer).innerHTML = "";
	
	var op = escape ( 'menu_country' );
	var isAnalysis = document.getElementById("View_RB").value;
	
	var url = "/geoutility.php?op="+ op + "&isAnalysis=" + isAnalysis;
	
	var selected_type = document.getElementsByName("Type[]");
	j = 0;
	for (i=0; i<selected_type.length; i++)
	{
		if(selected_type[i].checked)
		{
			url = url + "&type"+j+"=" + selected_type[i].value;
			j++;
		}
	}
	url = url + "&noOfTypes="+j;

	geoXmlHttpReq.onreadystatechange = commonHandler;
	geoXmlHttpReq.open("GET", url, true);
	geoXmlHttpReq.send(null);
}

function showAnalysisState ( )
{
	geoXmlHttpReq = null;
	obtainGeoXmlHttpRequest();
	
	if ( null == geoXmlHttpReq ) 
	{
		alert(geoXmlHttpReqErr);
		return;
	}

	geoContainer = "state_container";

	var isAnalysis = document.getElementById("View_RB").value;
	var op = escape ( 'menu_state_analyze' );
	var data = document.getElementById("Type_Analysis_RB").value;
	var url = "/geoutility.php?op="+ op + "&data=" + data;
	
    if( data == "Annual Performance" ) {
            setTimeout("showDecade()", 500);
    }

	// Get a list of all countries
	var country = document.getElementById("Country");
	var selected_countries = document.getElementById("Country");
	j = 0;
	for (i=0; i<selected_countries.length; i++)
	{
		if(selected_countries.options[i].selected == true)
		{
			url = url + "&country"+j+"=" + selected_countries.options[i].value;
			j++;
		}
	}
	url = url + "&noOfCountries="+j;
		
	// Get a list of all plant types
	var selected_type = document.getElementsByName("Type[]");
	j = 0;
	for (i=0; i<selected_type.length; i++)
	{
		if(selected_type[i].checked)
		{
			url = url + "&type"+j+"=" + selected_type[i].value;
			j++;
		}
	}
	url = url + "&noOfTypes="+j;

	geoXmlHttpReq.onreadystatechange = commonHandler;
	geoXmlHttpReq.open("GET", url, true);
	geoXmlHttpReq.send(null);
}

function showAnalysisConfig()
{
    text = "<table><tr> <td align='right'>Select View format</td>";
    text += "<td align='left'><input type='radio' name='View_RB' id='View_RB' value='View_Table' checked='checked'>Table</input>";
    text += "<input type='radio' name='View_RB' id='View_RB' value='View_Graph'>Graph</input><input type='radio' name='View_RB' id='View_RB' value='View_Map'>Map</input></td></tr><tr><td id='viewformat_help_container'/></tr><tr><td align='right'>Graph Type</td><td align='left'>";
    text += "<input type='radio' name='GraphType_RB' id='GraphType_RB' value='Individual Data'>Plot Each Type Separately</input><input type='radio' name='GraphType_RB' id='GraphType_RB' value='Aggregate Data'>Plot Aggregate Data</input><input type='radio' name='GraphType_RB' id='GraphType_RB' value='Overlay Data'>Plot Overlay</input>";
    text += "</td></tr><tr><td id='graphtype_help_container'/></tr></table></div>";

	document.getElementById("Analysis_Config").innerHTML = text;		
}

function showAnalysisButton() {
    text = '<input type="submit" id="Perform_Analysis" name="Perform_Analysis" value="Perform Analysis" onclick="return checkDecade()" style="margin: 10px 0px 0px 350px;"/>';
	document.getElementById("Analysis_Submit").innerHTML = text;		
}

function checkDecade() {
    if( !document.getElementById("Decade").value ) {
            alert("Please select a decade");
            return false;
    }
}
    
/***************Priya: End of Adding following methods for Analyses of data***************/
function showCountry ( callee ) {
	geoXmlHttpReq = null;
	obtainGeoXmlHttpRequest();
	
	if ( null == geoXmlHttpReq ) {
		alert(geoXmlHttpReqErr);
		return;
	}

    id='Type';
    params='';
	geoContainer = "country_container";
    if( callee ) {
        geoContainer = callee + "_" + geoContainer;
        params += "&callee=" + callee;
        id = callee + "_" + id;
    }

    j=0;
    for( i=0; i<document.getElementById(id).length; i++) { 
        if( document.getElementById(id).options[i].selected) {
            params += "&type"+j+"=" + document.getElementById(id).options[i].value;
            j++;
        }
    }
    params += "&typecount="+j;
    if( document.getElementById('multiple_sys') ) {
        if( document.getElementById('multiple_sys').value == 'true' )
            params += "&multiple=true";
    }

	var op = escape ( 'menu_country' );
	var url = "/geoutility.php?op="+ op + params;

    if( document.forms['select'] ) {
        if( document.forms['select'].Toggle )
	    for ( i=0; i<document.forms['select'].Toggle.length; i++ ) {
		    if ( document.forms['select'].Toggle[i].checked == true && document.forms['select'].Toggle[i].value == 'New') {
		    url += "&choose=new";
		    }
	    }
    }
	geoXmlHttpReq.onreadystatechange = commonHandler;
	geoXmlHttpReq.open("GET", url, true);
	geoXmlHttpReq.send(null);
}

function showState ( cal ) {
    callee = cal;
	geoXmlHttpReq = null;
	obtainGeoXmlHttpRequest();
	
	if ( null == geoXmlHttpReq ) {
		alert(geoXmlHttpReqErr);
		return;
	}

    db_id = 'db';
    type_id='Type';
    country_id = 'Country';

    params='';
	geoContainer = "state_container";
    if( callee ) {
        geoContainer = callee + "_" + geoContainer;
        params += "&callee=" + callee;
        type_id = callee + "_" + type_id;
        db_id = callee + "_" + db_id;
        country_id = callee + "_" + country_id;
    }

    j=0;
    for( i=0; i<document.getElementById(type_id).length; i++) { 
        if( document.getElementById(type_id).options[i].selected) {
            params += "&type"+j+"=" + document.getElementById(type_id).options[i].value;
            j++;
        }
    }
    params += "&typecount="+j;
    if( document.getElementById('multiple_sys') ) {
        if( document.getElementById('multiple_sys').value == 'true' )
            params += "&multiple=true";
    }

    j=0;
    for( i=0; i<document.getElementById(country_id).length; i++) { 
        if( document.getElementById(country_id).options[i].selected) {
            params += "&cnt"+j+"=" + document.getElementById(country_id).options[i].value;
            j++;
        }
    }
    params += "&cntcount="+j;

	var op = escape ( 'menu_state' );
	var url = "/geoutility.php?op="+ op + params;

    if( document.forms['select'] ) {
    if( document.forms['select'].Toggle )
	for ( i=0; i<document.forms['select'].Toggle.length; i++ )
	{
		if ( document.forms['select'].Toggle[i].checked == true && document.forms['select'].Toggle[i].value == 'New') 
		{
			url += "&choose=new";
		}
		else if ( document.forms['select'].Toggle[i].checked == true && document.forms['select'].Toggle[i].value == 'Kml') 
		{
			url += "&choose=kml";
		}
		// for CSV file (to show the state)
		else if( document.forms['select'].Toggle[i].checked == true && document.forms['select'].Toggle[i].value == 'CSV')
		{
			url+="&choose=CSV";
		}
		
	}
    }
	geoXmlHttpReq.onreadystatechange = stateHandler;
	geoXmlHttpReq.open("GET", url, true);
	geoXmlHttpReq.send(null);
}

function stateHandler() {
	var sem = 0;
	if ( 3 == geoXmlHttpReq.readyState )
	{
		document.getElementById(geoContainer).innerHTML = geoXmlHttpReqLoading;
	} else if ( 4 == geoXmlHttpReq.readyState ) 
	{
		if ( 200 == geoXmlHttpReq.status ) 
		{
			//alert(geoXmlHttpReq.responseText);
			
			//var db = document.getElementById(db_id).value;
			db = 'db'; 
			document.getElementById(geoContainer).innerHTML = geoXmlHttpReq.responseText;
			if( document.forms['select'] ) {
            if( document.forms['select'].Toggle )
			for ( i=0; i<document.forms['select'].Toggle.length; i++ )
			{
				if ( document.forms['select'].Toggle[i].checked == true && document.forms['select'].Toggle[i].value == 'Edit')
				{
					showName();
					sem=1;
				}
				//Priya: for downloading it as KML
				else if ( document.forms['select'].Toggle[i].checked == true && document.forms['select'].Toggle[i].value == 'Kml')
				{
					showDecade();
					sem=1;
			
				}
				
				//for downloading as CSV file
				else if( document.forms['select'].Toggle[i].checked == true && document.forms['select'].Toggle[i].value == 'CSV')
				{
					showDecade();
					sem=1;
				}
			}
            }
            else if( callee == 'ai' ) {
                setTimeout( 'showAIOther()', 500 );
                showName( callee );
                showAddAIButton();
                sem=1;
            }
            //adding a condition for map
            else {
                showSubmit(db);
                sem = 1;
            }
			if (sem == 0) {
				showNewButton( db );
			}
			/*
			if ( document.getElementById("Toggle").checked == false && document.getElementById("Toggle").value == 'Edit') {
				showName();
			}
			*/
			
		} else {
			alert(geoXmlHttpReqErr);
		}
	}
}
//Priya: to show decades for downloadin the file as KML
function showDecade(){
	geoContainer = "decade_container";
	var db = document.getElementById("db").value;
	var type = document.getElementById("Type").value;
	var country = document.getElementById("Country").value;
	var op = escape ( 'menu_decade' );
	var url = "/geoutility.php?op="+ op + "&type=" + type+"&cnt=" + country+"&db=" + db;
	geoXmlHttpReq.onreadystatechange = commonHandler;
	geoXmlHttpReq.open("GET", url, true);
	geoXmlHttpReq.send(null);
}

function showSubmit( db ) { 
    if( document.forms['select'] ) {
	for ( i=0; i<document.forms['select'].Toggle.length; i++ ) 
	{
		if ( document.forms['select'].Toggle[i].checked == true && document.forms['select'].Toggle[i].value == 'Edit') 
		{
			text = "<input type='submit' name='operation_sys' id='View and Edit Data' value='View and Edit Data' onclick='return check( this.value )' />";
			document.getElementById("submit_container").innerHTML = text;
		}
		else if ( document.forms['select'].Toggle[i].checked == true && document.forms['select'].Toggle[i].value == 'Kml') 
		{
			text = "<input type='submit' name='operation_sys' id='Download Kml' value='Download Kml' onclick='return check( this.value )' />";
			document.getElementById("submit_container").innerHTML = text;
		}
		
		//for CSV File
		else if ( document.forms['select'].Toggle[i].checked == true && document.forms['select'].Toggle[i].value == 'CSV') 
		{
			text = "<input type='submit' name='operation_sys' id='Download CSV' value='Download CSV' onclick='return check( this.value )' />";
			document.getElementById("submit_container").innerHTML = text;
		}
	}
    }
    //button for map...
    else {
        text = "<input type='button' name='operation_sys' id='Show_Map' value='Show Map Below' onclick='showMap()' />";
		//document.getElementById("submit_container").innerHTML = text;
    }

}

function showMap() {
	geoXmlHttpReq = null;
	obtainGeoXmlHttpRequest();
	
	if ( null == geoXmlHttpReq ) {
		alert(geoXmlHttpReqErr);
		return;
	}

	geoContainer = "data_container";
	
    j=0;
    params='';
    for( i=0; i<document.getElementById("db").length; i++) { 
        if( document.getElementById("db").options[i].selected) {
            params += "&db"+j+"=" + document.getElementById("db").options[i].value;
            j++;
        }
    }
    params += "&dbcount="+j;
    j=0;
    for( i=0; i<document.getElementById("Type").length; i++) { 
        if( document.getElementById("Type").options[i].selected) {
            params += "&type"+j+"=" + document.getElementById("Type").options[i].value;
            j++;
        }
    }
    params += "&typecount="+j;
    if( document.getElementById('multiple_sys') ) {
        if( document.getElementById('multiple_sys').value == 'true' )
            params += "&multiple=true";
    }

    params += "&cnt0=" + document.getElementById("Country").value;
    params += "&cntcount=0";

	if ( document.getElementById("State") ) {
        params += "&st0=" + document.getElementById("State").value;
        params += "&stcount=0";
	}
	else 
		params += "&st0=0";
	
	var op = escape ( 'map_details' );
	var url = "/geoutility.php?op="+ op + params;
	geoXmlHttpReq.onreadystatechange = mapHandler;
	geoXmlHttpReq.open("GET", url, true);
	geoXmlHttpReq.send(null);
}

function mapHandler () {
	if ( 3 == geoXmlHttpReq.readyState ) {
		document.getElementById(geoContainer).innerHTML = geoXmlHttpReqLoading;
	} else if ( 4 == geoXmlHttpReq.readyState ) {
		if ( 200 == geoXmlHttpReq.status ) {
			//alert(geoXmlHttpReq.responseText);
			document.getElementById(geoContainer).innerHTML = geoXmlHttpReq.responseText;
            generateMap();
            showMapResize();
		} else {
			alert(geoXmlHttpReqErr);
		}
	}
}

function showMapResize() {
    var map_cont = document.getElementById("map_container");
    var div = document.createElement("div");
    var span = document.createElement("span");
    var inner = "Width: <input type='text' value='900' size='4' name='Map_Width' id='Map_Width'>px ";
    inner += "Height: <input type='text' value='620' size='4' name='Map_Height' id='Map_Height'>px";
    inner += "<input type='button' onclick=\"resizeMap('map_main')\" class='button' value='Resize Map' name='Resize_Map'>";
    span.innerHTML = inner;
    div.appendChild(span);
    map_cont.parentNode.appendChild(div);
}

function showNewButton( db ) { 
	var db = document.getElementById("db").value;
	text = "<input type='submit' name='operation_sys' id='Create New "+db+"' value='Create New "+db+"' onclick='return check( this.value )' />";
	document.getElementById("new_container").innerHTML = text;
}

function showName ( cal ) {	
    callee = cal;
	geoXmlHttpReq = null;
	obtainGeoXmlHttpRequest();
	
	if ( null == geoXmlHttpReq ) {
		alert(geoXmlHttpReqErr);
		return;
	}

    db_id = 'db';
    type_id='Type';
    country_id = 'Country';
    state_id = 'State';

    params='';
	geoContainer = "name_container";
    if( callee ) {
        geoContainer = callee + "_" + geoContainer;
        params += "&callee=" + callee;
        type_id = callee + "_" + type_id;
        db_id = callee + "_" + db_id;
        country_id = callee + "_" + country_id;
        state_id = callee + "_" + state_id;
    }

	var db = document.getElementById(db_id).value;	
	var type = document.getElementById(type_id).value;
	var country = document.getElementById(country_id).value;
	
	if ( document.getElementById(state_id) ) {
		state = document.getElementById(state_id).value;
	}
	else 
		state = 0;
	
	
	var op = escape ( 'menu_name' );
	var url = "/geoutility.php?op="+ op + "&type=" + type + "&cnt=" + country + "&st=" + state + "&db=" + db + params;

	geoXmlHttpReq.onreadystatechange = commonHandler;
	geoXmlHttpReq.open("GET", url, true);
	geoXmlHttpReq.send(null);
}

function showLeftName () {
	
	geoXmlHttpReq = null;
	obtainGeoXmlHttpRequest();
	
	if ( null == geoXmlHttpReq ) {
		alert(geoXmlHttpReqErr);
		return;
	}

	geoContainer = "left_name_container";
	//var db = document.getElementById("db").value;
	var type = document.getElementById("Type_ID").value;
	var country = document.getElementById("Country_ID").value;
	var state = 0;
	
	var op = escape ( 'menu_name' );
	var url = "/geoutility.php?op="+ op + "&type=" + type + "&cnt=" + country + "&st=" + state;
	
	geoXmlHttpReq.onreadystatechange = commonHandler;
	geoXmlHttpReq.open("GET", url, true);
	geoXmlHttpReq.send(null);
}

var tr;
var noofanncap;

function addAnnCap () {
	geoXmlHttpReq = null;
	obtainGeoXmlHttpRequest();
	
	if ( null == geoXmlHttpReq ) {
		alert(geoXmlHttpReqErr);
		return;
	}
	
	geoContainer = "";
	var type = document.getElementById("Type").value;
	
	noofanncap = document.getElementById("NumberOfAnnCap").value;
	var op = escape ( 'add_anncap' );
	
	tr = document.createElement("tr");
	tr.setAttribute("id", "anncap"+(parseInt(noofanncap)+1));
	
	var url = "/geoutility.php?op="+ op + "&type=" + type + "&no=" + noofanncap;
	
	geoXmlHttpReq.onreadystatechange = anncapHandler;
	geoXmlHttpReq.open("GET", url, true);
	geoXmlHttpReq.send(null);
}

function anncapHandler() {

	if ( 3 == geoXmlHttpReq.readyState ) {
		//document.getElementById(geoContainer).innerHTML = geoXmlHttpReqLoading;
	} else if ( 4 == geoXmlHttpReq.readyState ) {
		if ( 200 == geoXmlHttpReq.status ) {
			$str = geoXmlHttpReq.responseText;
            var tstr = $str.split( '<?xml version="1.0"?>' );
            var str = tstr[1];
			$arr = str.split("<td>");
			for ( i=1; i<$arr.length; i++) {
				var td = document.createElement("td");
				td.innerHTML = $arr[i]; 
				tr.appendChild(td);
			}
			document.getElementById("anncap0").parentNode.appendChild(tr);
			document.getElementById("NumberOfAnnCap").value = parseInt ( noofanncap ) +1;
		} else {
			alert(geoXmlHttpReqErr);
		}
	}
}

function deleteAnnCap() {
	noofanncap = document.getElementById("NumberOfAnnCap").value;
    var oldNum = noofanncap;
	for ( i=1; i<=noofanncap; i++ ) {
		var anncapcheck = document.getElementById("anncapcheck"+i);
		if ( anncapcheck && anncapcheck.checked ) {
			document.getElementById("anncap0").parentNode.removeChild ( document.getElementById("anncap"+i) );
	        document.getElementById("NumberOfAnnCap").value = parseInt(noofanncap)-1;
		}
	}
    updateSequence( 'anncap', '', oldNum );
}

var tr;
var noofunits;

function addUnit () {
	geoXmlHttpReq = null;
	obtainGeoXmlHttpRequest();
	
	if ( null == geoXmlHttpReq ) {
		alert(geoXmlHttpReqErr);
		return;
	}
	
	geoContainer = "";
	var type = document.getElementById("Type").value;
	
	noofunits = document.getElementById("NumberOfUnits").value;
	var op = escape ( 'add_unit' );
	
	tr = document.createElement("tr");
	tr.setAttribute("id", "unit"+(parseInt(noofunits)+1));
	
	var url = "/geoutility.php?op="+ op + "&type=" + type + "&no=" + noofunits;
	
	geoXmlHttpReq.onreadystatechange = unitHandler;
	geoXmlHttpReq.open("GET", url, true);
	geoXmlHttpReq.send(null);
}

function unitHandler() {

	if ( 3 == geoXmlHttpReq.readyState ) {
		document.getElementById(geoContainer).innerHTML = geoXmlHttpReqLoading;
	} else if ( 4 == geoXmlHttpReq.readyState ) {
		if ( 200 == geoXmlHttpReq.status ) {
			$str = geoXmlHttpReq.responseText;
			$arr = $str.split("<td>");
			for ( i=1; i<$arr.length; i++) {
				var td = document.createElement("td");
				td.innerHTML = $arr[i]; 
				tr.appendChild(td);
			}
			document.getElementById("unit0").parentNode.appendChild(tr);
			if ( document.getElementById("unit_control_0") ) {
				addUnitControl();
			}
			else {
				document.getElementById("NumberOfUnits").value = parseInt ( noofunits) +1;
				
				if(document.getElementById("Type").value == 'Nuclear' )
					getPerformance();
			}
			
		} else {
			alert(geoXmlHttpReqErr);
		}
	}
}

function addUnitControl () {
	geoXmlHttpReq = null;
	obtainGeoXmlHttpRequest();
	
	if ( null == geoXmlHttpReq ) {
		alert(geoXmlHttpReqErr);
		return;
	}

//	var tr = document.createElement("tr");
//	tr.setAttribute("id", "unit")
	
	geoContainer = "";
	var type = document.getElementById("Type").value;
	
	//var number = document.getElementById("NumberOfUnits").value;
	var op = escape ( 'add_unit_control' );
	
	tr = document.createElement("tr");
	tr.setAttribute("id", "unit_control_"+(parseInt(noofunits)+1));
	
	var url = "/geoutility.php?op="+ op + "&type=" + type + "&no=" + noofunits;
	
	geoXmlHttpReq.onreadystatechange = unitControlHandler;
	geoXmlHttpReq.open("GET", url, true);
	geoXmlHttpReq.send(null);
}

function unitControlHandler() {

	if ( 3 == geoXmlHttpReq.readyState ) {
		document.getElementById(geoContainer).innerHTML = geoXmlHttpReqLoading;
	} else if ( 4 == geoXmlHttpReq.readyState ) {
		if ( 200 == geoXmlHttpReq.status ) {
			str = geoXmlHttpReq.responseText;
			arr = str.split("<td>");
			for ( i=1; i<arr.length; i++) {
				var td = document.createElement("td");
				td.innerHTML = arr[i]; 
				tr.appendChild(td);
			}
			document.getElementById("unit_control_0").parentNode.appendChild(tr);
			document.getElementById("NumberOfUnits").value = parseInt(noofunits)+1;
		} else {
			alert(geoXmlHttpReqErr);
		}
	}
}

function deleteUnit() {
	noofunits = document.getElementById("NumberOfUnits").value;
	var oldNum = noofunits;
	for ( i=1; i<=noofunits; i++ ) {
		var unitcheck = document.getElementById("unitcheck"+i);
		if ( unitcheck && unitcheck.checked ) {
			document.getElementById("unit0").parentNode.removeChild ( document.getElementById("unit"+i) );
			document.getElementById("unit_control_0").parentNode.removeChild ( document.getElementById("unit_control_"+i) );
	        document.getElementById("NumberOfUnits").value = parseInt(noofunits)-1;
		}
	}
    updateUnitSequence( 'unit', '', oldNum );
    updateUnitSequence( 'unit_control_', '', oldNum );
}

function updateUnitSequence( par, name, oldNum ) {
	var k=0;
    for( i=1; i<=oldNum; i++ ) {
    	if( document.getElementById( par+i ) ) {
    		k++;
    	    var root = document.getElementById(par+i);
    	    var children = root.getElementsByTagName('td');
    	    var len = root.children.length;

    	    var check = root.children[0].childNodes[1];

            if( par != 'unit_control_' ) {
    	        check.setAttribute( 'id', par+'check'+k );
    	        check.setAttribute( 'name', par+'check'+k );
    	        check.setAttribute( 'value', k );
    	    }

            root.children[0].childNodes[0].nodeValue = k;
    	    for( l=1; l<len; l++ ) {
  	    		var ele = root.childNodes[l].childNodes[0];

  	    		if( ele.nodeValue == null ) {
  	    			if( ele.hasAttribute('name') ) {
  	    				var oldName = ele.getAttribute('name');
  	    				var oldNameLength = oldName.length;
  	    				oldName = oldName.substring( 0, ( oldNameLength-1 ) );

  	    				ele.setAttribute( 'name', oldName+k );
  	    				ele.setAttribute( 'id', oldName+k );
  	    			}
  	    		}
/*  	    		else if( ele.nodeValue.trim() == '-' ) {
  	    			ele.nodeValue = '';
  	    			alert( ele.nodeValue );
  	    		}
  */	    		
  	    		
    	    }
    	    root.setAttribute('id', par+k);
    	}
    }   
}
function plotPerformanceGraph() {

    var PerformanceCount = document.getElementById("Performance_Field_Count").value;
    var url = "/includes/utilities/PerformanceGraph.php?";
    var j = 1;
    var url;

    var type = document.getElementById("Type").value;
    if( type == "Nuclear" ) 
        url += "noofunits="+document.getElementById("NumberOfUnits").value+"&";
    for (i=0; i<PerformanceCount; i++) {    
    	var Parameter = "perfcheck" + i;
    	
            var m = document.getElementById(Parameter);
            if( m.checked == true ) {
                    url += "parameter"+j+"="+m.value+"&";
                    j++;
            }
    }
    
    url += 'count='+(j-1)+"&type="+type;

	url += "&uid=" + document.getElementById("uniqueID").value;
    window.open(url,'Graph','width=1000,height=500,location=no,menubar=no,status=no,toolbar=no,resizable=no');
}

function plotPerformanceRatioGraph() {

    var PerformanceCount = document.getElementById("Performance_Field_Count").value;
    var url = "/includes/utilities/PerformanceRatioGraph.php?";
    var j = 1;
    var url;
    var type = document.getElementById("Type").value;
    url += "type="+type+"&";

    if( type == "Nuclear" ) 
        url += "noofunits="+document.getElementById("NumberOfUnits").value+"&";

    for (i=0; i<PerformanceCount; i++) {    
    	var Parameter = "perfcheck" + i;
    	
            var m = document.getElementById(Parameter);
            if( m.checked == true ) {
                    url += "parameter"+j+"="+m.value+"&";
                    j++;
            }
    }
    
    url += 'count='+(j-1);

	url += "&uid=" + document.getElementById("uniqueID").value;
    window.open(url,'Graph','width=1000,height=500,location=no,menubar=no,status=no,toolbar=no,resizable=no');
}

function getPerformance ( decade ) {

	geoXmlHttpReq = null;
	obtainGeoXmlHttpRequest();
	
	if ( null == geoXmlHttpReq ) {
		alert(geoXmlHttpReqErr);
		return;
	}
	geoContainer = "PerformanceTable";
	var type = document.getElementById("Type").value;	
		
	var params = "type=" + type;
	
	if (type == 'Nuclear' ) {
		params += "&noofunits=" + document.getElementById("NumberOfUnits").value; 
	}
	
	if ( !decade ) {
		decade = '2000-2009';
		if(document.getElementById("PerformanceDecade"))
			document.getElementById("PerformanceDecade").selectedIndex = decade;
		params += "&op=performance";
	}
	else {
		params += "&op=change_decade";
		perf = document.getElementById("PerfTable").value;
		params += "&perf=" + perf;
	}
	var years = decade.split("-");
	var StartYear = years[0];
	var EndYear = years[1];	

	params += "&did=" + document.getElementById("Description_ID").value;
	params += "&StartYear=" + StartYear + "&EndYear=" + EndYear;
	
	if ( document.getElementById("decade") ) {
		
		var previousDecade = document.getElementById("decade").value;
		
		var years = previousDecade.split("-");
		var previousStartYear = years[0];
		var previousEndYear = years[1];	
		
		params += "&previousStartYear=" + previousStartYear + "&previousEndYear=" + previousEndYear;
		
		if ( previousStartYear < previousEndYear ) {
				for  ( i=0; i<document.getElementById("Performance_Field_Count").value; i++ ) {
					var ele = document.getElementById("perfcheck"+i).parentNode.parentNode;
					
					for ( j=0; j<ele.childNodes.length; j++) {
						if ( ele.childNodes[j].childNodes[0].tagName && !ele.childNodes[j].childNodes[0].getAttribute('id').match ( /perfcheck?/ ) ) {
							id = ele.childNodes[j].childNodes[0].getAttribute('id');
							if ( document.getElementById(id).value ) {
								value = document.getElementById(id).value;
								params += "&" + id + "=" + value;
							}
						}
					}
				}
		}
	}
	
	geoXmlHttpReq.onreadystatechange = commonHandler;
	geoXmlHttpReq.open ( "POST", "/geoutility.php", true );
    geoXmlHttpReq.setRequestHeader ( "Content-type", "application/x-www-form-urlencoded" );
    geoXmlHttpReq.send (params);
}

var tr;
var noofupgrades;

function addUpgrade () {
	geoXmlHttpReq = null;
	obtainGeoXmlHttpRequest();
	
	if ( null == geoXmlHttpReq ) {
		alert(geoXmlHttpReqErr);
		return;
	}
	
	geoContainer = "";
	var type = document.getElementById("Type").value;
	
	noofupgrades = document.getElementById("NumberOfUpgrades").value;
	var op = escape ( 'add_upgrade' );
	
	tr = document.createElement("tr");
	tr.setAttribute("id", "upgrade"+(parseInt(noofupgrades)+1));
	
	var url = "/geoutility.php?op="+ op + "&type=" + type + "&no=" + noofupgrades;
	
	geoXmlHttpReq.onreadystatechange = upgradeHandler;
	geoXmlHttpReq.open("GET", url, true);
	geoXmlHttpReq.send(null);
	
}

function upgradeHandler() {

	if ( 3 == geoXmlHttpReq.readyState ) {
		document.getElementById(geoContainer).innerHTML = geoXmlHttpReqLoading;
	} else if ( 4 == geoXmlHttpReq.readyState ) {
		if ( 200 == geoXmlHttpReq.status ) {
			$str = geoXmlHttpReq.responseText;
			$arr = $str.split("<td>");
			for ( i=1; i<$arr.length; i++) {
				var td = document.createElement("td");
				td.innerHTML = $arr[i].trim(); 
				tr.appendChild(td);
			}
			document.getElementById("upgrade0").parentNode.appendChild(tr);
			document.getElementById("NumberOfUpgrades").value = ++noofupgrades; 
			
		} else {
			alert(geoXmlHttpReqErr);
		}
	}
}

function deleteUpgrade() {
	noofupgrades = document.getElementById("NumberOfUpgrades").value;
	var oldNum = noofupgrades;
	for ( i=1; i<=noofupgrades; i++ ) {
		var upgradecheck = document.getElementById("upgradecheck"+i);
		if ( upgradecheck && upgradecheck.checked ) {
			document.getElementById("upgrade0").parentNode.removeChild ( document.getElementById("upgrade"+i) );
	        document.getElementById("NumberOfUpgrades").value = --noofupgrades;
		}
	}
    updateSequence( 'upgrade', 'Upgrade', oldNum );
	
}

var tr;
var noofenviss;

function addEnvIss () {
	geoXmlHttpReq = null;
	obtainGeoXmlHttpRequest();
	
	if ( null == geoXmlHttpReq ) {
		alert(geoXmlHttpReqErr);
		return;
	}
	
	geoContainer = "";
	var type = document.getElementById("Type").value;
	
	noofenviss = document.getElementById("NumberOfEnvironmentalIssues").value;
	var op = escape ( 'add_enviss' );
	
	tr = document.createElement("tr");
	tr.setAttribute("id", "environmentalissues"+(parseInt(noofenviss)+1));
	
	var url = "/geoutility.php?op="+ op + "&type=" + type + "&no=" + noofenviss;
	
	geoXmlHttpReq.onreadystatechange = envissHandler;
	geoXmlHttpReq.open("GET", url, true);
	geoXmlHttpReq.send(null);
	
}

function envissHandler() {

	if ( 3 == geoXmlHttpReq.readyState ) {
		document.getElementById(geoContainer).innerHTML = geoXmlHttpReqLoading;
	} else if ( 4 == geoXmlHttpReq.readyState ) {
		if ( 200 == geoXmlHttpReq.status ) {
			$str = geoXmlHttpReq.responseText;
			$arr = $str.split("<td>");
			for ( i=1; i<$arr.length; i++) {
				var td = document.createElement("td");
				td.innerHTML = $arr[i].trim(); 
				tr.appendChild(td);
			}
			document.getElementById("environmentalissues0").parentNode.appendChild(tr);
			document.getElementById("NumberOfEnvironmentalIssues").value = ++noofenviss; 
			
		} else {
			alert(geoXmlHttpReqErr);
		}
	}
}

function deleteEnvIss() {
	noofenviss = document.getElementById("NumberOfEnvironmentalIssues").value;
	var oldNum = noofenviss;
	for ( i=1; i<=noofenviss; i++ ) {
		var envisscheck = document.getElementById("environmentalissuescheck"+i);
		if ( envisscheck && envisscheck.checked ) {
			document.getElementById("environmentalissues0").parentNode.removeChild ( document.getElementById("environmentalissues"+i) );
	        document.getElementById("NumberOfEnvironmentalIssues").value = --noofenviss;
		}
	}
    updateSequence( 'environmentalissues', 'Issue', oldNum );
	
}
var tr;
var noofowners;

function addOwner () {
	
	geoXmlHttpReq = null;
	obtainGeoXmlHttpRequest();
	
	if ( null == geoXmlHttpReq ) {
		alert(geoXmlHttpReqErr);
		return;
	}
	
	geoContainer = "";
	var type = document.getElementById("Type").value;
	noofowners = document.getElementById("NumberOfOwners").value;
	var op = escape ( 'add_owners' );
	
	tr = document.createElement("tr");
	tr.setAttribute("id", "owners"+(parseInt(noofowners)+1));
	
	var url = "/geoutility.php?op="+ op + "&type=" + type + "&no=" + noofowners;
	
	geoXmlHttpReq.onreadystatechange = ownersHandler;
	geoXmlHttpReq.open("GET", url, true);
	geoXmlHttpReq.send(null);
}

function ownersHandler() {

	if ( 3 == geoXmlHttpReq.readyState ) {
		document.getElementById(geoContainer).innerHTML = geoXmlHttpReqLoading;
	} else if ( 4 == geoXmlHttpReq.readyState ) {
		if ( 200 == geoXmlHttpReq.status ) {
			$str = geoXmlHttpReq.responseText;
			$arr = $str.split("<td>");
			for ( i=1; i<$arr.length; i++) {
				var td = document.createElement("td");
				td.innerHTML = $arr[i].trim(); 
				tr.appendChild(td);
			}
			document.getElementById("owners0").parentNode.appendChild(tr);
			document.getElementById("NumberOfOwners").value = ++noofowners; 
			
		} else {
			alert(geoXmlHttpReqErr);
		}
	}
}

function deleteOwner() {
	noofowners = document.getElementById("NumberOfOwners").value;
	var oldNum = noofowners;
	
	for ( i=1; i<=noofowners; i++ ) {
		var ownerscheck = document.getElementById("ownerscheck"+i);
		if ( ownerscheck && ownerscheck.checked ) {
			document.getElementById("owners0").parentNode.removeChild ( document.getElementById("owners"+i) );
	        document.getElementById("NumberOfOwners").value = --noofowners;
		}
	}
    updateSequence( 'owners', 'Owner', oldNum );	
}

var tr;
var noofcomments;

function addComments () {
	
	geoXmlHttpReq = null;
	obtainGeoXmlHttpRequest();
	
	if ( null == geoXmlHttpReq ) {
		alert(geoXmlHttpReqErr);
		return;
	}
	
	geoContainer = "";
	var type = document.getElementById("Type").value;
	noofcomments = document.getElementById("NumberOfComments").value;
	var op = escape ( 'add_comments' );
	
	tr = document.createElement("tr");
	tr.setAttribute("id", "comments"+(parseInt(noofcomments)+1));
	
	var url = "/geoutility.php?op="+ op + "&type=" + type + "&no=" + noofcomments;
	
	geoXmlHttpReq.onreadystatechange = commentsHandler;
	geoXmlHttpReq.open("GET", url, true);
	geoXmlHttpReq.send(null);
}

function commentsHandler() {

	if ( 3 == geoXmlHttpReq.readyState ) {
		document.getElementById(geoContainer).innerHTML = geoXmlHttpReqLoading;
	} else if ( 4 == geoXmlHttpReq.readyState ) {
		if ( 200 == geoXmlHttpReq.status ) {
			$str = geoXmlHttpReq.responseText;
			$arr = $str.split("<td>");
			for ( i=1; i<$arr.length; i++) {
				var td = document.createElement("td");
				td.innerHTML = $arr[i].trim(); 
				tr.appendChild(td);
			}
			document.getElementById("comments0").parentNode.appendChild(tr);
			document.getElementById("NumberOfComments").value = ++noofcomments; 
			
		} else {
			alert(geoXmlHttpReqErr);
		}
	}
}

function deleteComments() {
	noofcomments = document.getElementById("NumberOfComments").value;
	var oldNum = noofcomments;
	
	for ( i=1; i<=noofcomments; i++ ) {
		var commentscheck = document.getElementById("commentscheck"+i);
		if ( commentscheck && commentscheck.checked ) {
			document.getElementById("comments0").parentNode.removeChild ( document.getElementById("comments"+i) );
	        document.getElementById("NumberOfComments").value = --noofcomments;
		}
	}
    updateSequence( 'comments', 'Comment', oldNum );
}

var tr;
var noofreferences;

function addReferences () {
	geoXmlHttpReq = null;
	obtainGeoXmlHttpRequest();
	
	if ( null == geoXmlHttpReq ) {
		alert(geoXmlHttpReqErr);
		return;
	}
	
	geoContainer = "";
	var type = document.getElementById("Type").value;
	
	noofreferences = document.getElementById("NumberOfReferences").value;
	var op = escape ( 'add_references' );
	
	tr = document.createElement("tr");
	tr.setAttribute("id", "references"+(parseInt(noofreferences)+1));
	
	var url = "/geoutility.php?op="+ op + "&type=" + type + "&no=" + noofreferences;
	
	geoXmlHttpReq.onreadystatechange = referencesHandler;
	geoXmlHttpReq.open("GET", url, true);
	geoXmlHttpReq.send(null);
}

String.prototype.trim = function () {
    return this.replace(/^\s+|\s+$|\n/g, "").replace(/\s*$/, "");
}

function referencesHandler() {

	if ( 3 == geoXmlHttpReq.readyState ) {
		document.getElementById(geoContainer).innerHTML = geoXmlHttpReqLoading;
	} else if ( 4 == geoXmlHttpReq.readyState ) {
		if ( 200 == geoXmlHttpReq.status ) {
			$str = geoXmlHttpReq.responseText;
			$arr = $str.split("<td>");
			for ( i=1; i<$arr.length; i++) {
				var td = document.createElement("td");
				td.innerHTML = $arr[i].trim(); 
				tr.appendChild(td);
			}

			document.getElementById("references0").parentNode.appendChild(tr);
			document.getElementById("NumberOfReferences").value = ++noofreferences; 
			
		} else {
			alert(geoXmlHttpReqErr);
		}
	}
}

function deleteReferences() {
	noofreferences = document.getElementById("NumberOfReferences").value;
    var oldNum = noofreferences;
	for ( i=1; i<=noofreferences; i++ ) {
		var referencescheck = document.getElementById("referencescheck"+i);
		if ( referencescheck && referencescheck.checked ) {
			document.getElementById("references0").parentNode.removeChild ( document.getElementById("references"+i) );
	        document.getElementById("NumberOfReferences").value = --noofreferences;
		}
	}
    updateSequence( 'references', 'Reference', oldNum );
}

function updateSequence( par, name, oldNum ) {
	var k=0;
    for( i=1; i<=oldNum; i++ ) {
    	if( document.getElementById( par+i ) ) {
    		k++;
    	    var root = document.getElementById(par+i);
    	    var children = root.getElementsByTagName('td');
    	    var len = root.children.length;

    	    var check = root.children[0].childNodes[0];

    	    check.setAttribute( 'id', par+'check'+k );
    	    check.setAttribute( 'name', par+'check'+k );
    	    check.setAttribute( 'value', k );
    	    
    	    root.childNodes[1].childNodes[0].nodeValue = name + ' ' + k;
    	    for( l=2; l<len; l++ ) {
  	    		var ele = root.childNodes[l].childNodes[0];

  	    		if( ele.nodeValue == null ) {
  	    			if( ele.hasAttribute('name') ) {
  	    				var oldName = ele.getAttribute('name');
  	    				var oldNameLength = oldName.length;
  	    				oldName = oldName.substring( 0, ( oldNameLength-1 ) );

  	    				ele.setAttribute( 'name', oldName+k );
  	    				ele.setAttribute( 'id', oldName+k );
  	    			}
  	    		}
/*  	    		else if( ele.nodeValue.trim() == '-' ) {
  	    			ele.nodeValue = '';
  	    			alert( ele.nodeValue );
  	    		}
  */	    		
  	    		
    	    }
    	    root.setAttribute('id', par+k);
    	}
    }   
}

function computeModel( mtype ) {
   
	geoXmlHttpReq = null;
	obtainGeoXmlHttpRequest();
	
	if ( null == geoXmlHttpReq ) {
		alert(geoXmlHttpReqErr);
		return;
	}
	geoContainer = "";
	params = "?op=model" + '&mtype=' + mtype;

    var ele = document.getElementById("modeling0");
					for ( j=0; j<ele.childNodes.length; j++) {
						if ( ele.childNodes[j].childNodes[0].tagName ) {
							id = ele.childNodes[j].childNodes[0].getAttribute('id');
							if ( document.getElementById(id).value ) {
								value = document.getElementById(id).value;
								params += "&" + id + "=" + value;
							}
                            else {
                                alert("All fields are required to compute the model.");
                                break;
                            }
						}
					}
    var url = "/geoutility.php"+params;
	geoXmlHttpReq.onreadystatechange = modelHandler;
   	geoXmlHttpReq.open("GET", url, true);
	geoXmlHttpReq.send(null);
}

function modelHandler() {

	if ( 3 == geoXmlHttpReq.readyState ) {
//		document.getElementById(geoContainer).innerHTML = geoXmlHttpReqLoading;
	} else if ( 4 == geoXmlHttpReq.readyState ) {
		if ( 200 == geoXmlHttpReq.status ) {
			str = geoXmlHttpReq.responseText;
			arr = str.split(",");
            var circleColor = new Array("#151B54", "#8D38C9", "#800517", "#3B9C9C", "#4E9258" ); 
            var circleOpacity = new Array("0.9", "0.7", "0.6", "0.4", "0.3" );
            year = 0;

            for( i=0; i<arr.length-1; i++ ) {
                if( arr[i] > 0 ) {
                    year = year+5;
                    drawModelCircle( arr[i], document.getElementById('Latitude_Start').value, document.getElementById('Longitude_Start').value, circleColor[i], circleOpacity[i], "In " + year + " years" );
                }
                else {
                    alert( "Could not compute the model. Please check if the values entered are correct" );
                    break;
                }
            }
		} else {
			alert(geoXmlHttpReqErr);
		}
	}
}

/*function getCookie (name) {
    var dc = document.cookie;
    var cname = name + "=";

    if (dc.length > 0) {
      begin = dc.indexOf(cname);
      if (begin != -1) {
        begin += cname.length;
        end = dc.indexOf(";" begin);
        if (end == -1) end = dc.length;
        return unescape(dc.substring(begin, end));
        }
      }
 
 	return null;
}*/
